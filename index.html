<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>IGCSE Past Paper Finder</title>

<style>
/* ========= GLOBAL STYLES ========= */
* { box-sizing: border-box; }
html, body {
  margin: 0; padding: 0;
  font-family: Arial, sans-serif;
  background-color: #222;
  color: white;
}
body {
  display: flex; flex-direction: column;
  min-height: 100vh;
}

/* ========= HEADINGS ========= */
h2 {
  text-align: center;
  margin: 2vh 0;
  font-size: 4vh;
}

/* ========= LAYOUT CONTAINERS ========= */
.wrapper {
  flex: 1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  width:100%;
}
.form-container {
  display:flex; flex-direction:column;
  gap:2vh;
  width:95%; max-width:600px;
  margin:0 auto;
}

/* ========= FORM FIELDS ========= */
.field { display:flex; flex-direction:column; width:100%; }
label {
  font-weight:bold;
  margin-bottom:0.5vh;
  font-size:3vh;
}
input {
  width:100%; height:6vh;
  font-size:2.5vh;
  padding:0.5vh 10px;
  border-radius:8px;
  border:1px solid white;
  background-color:black; color:white;
}
input:focus { outline:none; }

/* Error message styling */
#error {
  color:#ff6b6b;
  font-weight:bold;
  text-align:center;
  margin-top:1vh;
  font-size:2.2vh;
  min-height:2.2em;
}

/* Row for year + paper input */
.field-row {
  display:flex;
  width:100%;
  gap:2vw;
}
.field-row .field { flex:1; }

/* ========= BUTTON GROUPS ========= */
.button-group {
  display:flex;
  flex-wrap:wrap;
  gap:1vh;
  width:100%;
}
.button-group button {
  position: relative;
  flex:1; min-width:30%;
  padding:1.2vh 0;
  font-size:clamp(2.2vh,2vw,2.5vh);
  border-radius:8px;
  border:1px solid white;
  background-color:black; color:white;
  cursor:pointer;
  text-align:center;
  transition:all .2s;
}
.button-group button:hover { background-color:#444; }
.button-group button.selected { border:3px solid white; }

/* ========= MAIN DOCUMENT BUTTONS ========= */
.buttons {
  display:grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto;
  gap:2vh;
  width:100%; max-width:600px;
  margin:2vh auto 0 auto;
}
button.main {
  position: relative;
  width:100%; height:7.5vh;
  font-size:clamp(2.2vh,2vw,2.4vh);
  border-radius:8px;
  border:1px solid white;
  background-color:black; color:white;
  cursor:pointer;
}
button.main:hover { background-color:#444; }

/* Container for QP + MS (and possibly TN/Alt) */
#qpMsContainer {
  display:flex;
  width:100%;
  gap:1vw;
  grid-column: span 2;
}

/* ========= KEYBOARD GUIDE OUTLINE ========= */
.kbd-step { 
  outline: 2px dashed rgba(255,255,255,.35); 
  outline-offset: 2px; 
  border-radius: 6px; 
}

/* Tiny number hints on each button */
.hint {
  position:absolute;
  top:2px; left:4px;
  font-size:0.8em;
  opacity:0.6;
  pointer-events:none;
}

/* ========= MOBILE RESPONSIVE ========= */
@media(max-width:767px) {
  input, .button-group button, button.main {
    font-size:clamp(2.2vh,3vw,2.6vh);
    height:7.5vh;
  }
  button.main { height:8.5vh; }
  .buttons {
    width:100%; max-width:100%;
    grid-template-columns:1fr 1fr;
    gap:1vw;
    margin:2vh 0 0 0;
    padding:0 3vw;
  }
  .form-container { width:100%; padding:0 3vw; }
}
</style>
</head>

<body>
<h2>IGCSE Past Paper Finder</h2>

<div class="wrapper">
  <!-- ========== INPUT FORM ========== -->
  <div class="form-container">
    <!-- Subject selection -->
    <div class="field" id="subjectField">
      <label>Subject:</label>
      <div class="button-group" id="subjectButtons"></div>
    </div>

    <!-- Year + Paper inputs -->
    <div class="field-row">
      <div class="field" id="yearField">
        <label for="year">Year:</label>
        <input type="text" id="year" pattern="\\d{2}|\\d{4}" title="Enter 2 or 4 digits" autocomplete="off">
      </div>
      <div class="field" id="paperField">
        <label for="paper">Paper/Variant:</label>
        <input type="text" id="paper" pattern="\\d{2}" title="Enter 2 digits" autocomplete="off">
      </div>
    </div>

    <!-- Season selection -->
    <div class="field" id="seasonField">
      <label>Season:</label>
      <div class="button-group" id="seasonButtons"></div>
    </div>

    <!-- Error message display -->
    <div id="error"></div>
  </div>

  <!-- ========== DOCUMENT BUTTONS ========== -->
  <div class="buttons">
    <!-- QP + MS/TN/Alt go here -->
    <div id="qpMsContainer"></div>
    <!-- Always present -->
    <button class="main" id="erBtn"><span class="hint">3</span>ER</button>
    <button class="main" id="gtBtn"><span class="hint">4</span>GT</button>
  </div>
</div>

<script>
/* ========= CONFIG DATA ========= */
const subjects = ['Math','English','Physics','Chemistry','Biology','Economics','ICT','French'];
const seasons  = ['Feb/Mar','May/Jun','Oct/Nov'];

let kbdStep = 0;  // tracks keyboard "focus step"

/* ========= STEP HANDLING ========= */
function advanceStep() { kbdStep = (kbdStep + 1) % 5; clampStep(); focusForStep(); }
function retreatStep() { kbdStep = (kbdStep - 1 + 5) % 5; clampStep(); focusForStep(); }

/* ========= BUTTON CREATION ========= */
function createButtonGroup(containerId, options, startNum = 1, advanceOnClick = true) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  options.forEach((opt, idx) => {
    const btn = document.createElement('button');
    btn.innerHTML = `<span class="hint">${startNum + idx}</span>${opt}`;
    btn.dataset.index = String(startNum + idx);

    btn.addEventListener('click', () => {
      // only one button selected at a time
      container.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      updateQPButtons(); updateOtherButtons();
      if (advanceOnClick) advanceStep();
    });

    container.appendChild(btn);
  });
}

// build subject + season groups
createButtonGroup('subjectButtons', subjects, 1, false);
createButtonGroup('seasonButtons', seasons, 1, false);

/* ========= HELPER: GET CURRENT CODES ========= */
function getCodes() {
  const subjectBtn = document.querySelector('#subjectButtons button.selected');
  const yearInput  = document.getElementById('year').value.trim();
  const paperInput = document.getElementById('paper').value.trim();
  const seasonBtn  = document.querySelector('#seasonButtons button.selected');
  if (!subjectBtn || !yearInput || !seasonBtn) return null;

  const subjectMap = {
    "Math": "0607", "English": "0500", "Physics": "0625",
    "Chemistry": "0620", "Biology": "0610", "Economics": "0455",
    "ICT": "0417", "French": "0520"
  };
  const seasonMap = { "Feb/Mar": "m", "May/Jun": "s", "Oct/Nov": "w" };

  let year = yearInput;
  if (year.length === 4 && year.startsWith('20')) year = year.substring(2);

  return {
    subjCode: subjectMap[subjectBtn.textContent.replace(/^[0-9]+/, '')],
    seasonCode: seasonMap[seasonBtn.textContent.replace(/^[0-9]+/, '')],
    year,
    paper: paperInput,
    subject: subjectBtn.textContent.replace(/^[0-9]+/, '').trim(),
    fullYear: yearInput
  };
}

/* ========= ERROR DISPLAY ========= */
function showError(msg) {
  document.getElementById('error').textContent = msg;
}

/* ========= DOCUMENT URL BUILDER ========= */
function openDoc(type, ext = 'pdf') {
  const c = getCodes();
  if (!c) { showError("Fill all fields first."); return; }
  if ((['qp','ms','tn','in','sf','su'].includes(type)) && c.paper === '') {
    showError("Enter paper/variant."); return;
  }
  showError('');

  const base = `https://pastpapers.papacambridge.com/directories/CAIE/CAIE-pastpapers/upload/${c.subjCode}_${c.seasonCode}${c.year}_`;
  let url;
  if (type === 'tn')      url = `${base}tn_${c.paper}.pdf`;
  else if (type === 'er') url = `${base}er.pdf`;
  else if (type === 'gt') url = `${base}gt.pdf`;
  else                    url = `${base}${type}_${c.paper}.${ext}`;

  window.open(url, '_blank');
}

/* ========= UPDATE QP + MS/ALT/TN ========= */
function updateQPButtons() {
  const codes = getCodes();
  const qpMsContainer = document.getElementById('qpMsContainer');
  qpMsContainer.innerHTML = '';

  // French paper 03 special case → TN
  if (codes && codes.subject === 'French' && codes.paper === '03') {
    const tn = document.createElement('button');
    tn.className = 'main'; tn.id = 'tnBtn';
    tn.innerHTML = '<span class="hint">1</span>TN';
    tn.onclick = () => { openDoc('tn'); advanceStep(); };
    qpMsContainer.appendChild(tn);
    return;
  }

  // ALT button conditions
  let altType = null, altExt = 'pdf', altLabel = '';
  if (codes && codes.paper !== '') {
    if (codes.subject === 'English') {
      altType = 'in'; altLabel = 'IN';
    } else if (codes.subject === 'French' && codes.paper.startsWith('1')) {
      const y = parseInt(codes.year, 10);
      altType = (y >= 18) ? 'sf' : 'su';
      altLabel = 'Audio'; altExt = 'mp3';
    }
  }

  // Always add QP
  const qp = document.createElement('button');
  qp.className = 'main'; qp.id = 'qpBtn';
  qp.innerHTML = '<span class="hint">1</span>QP';
  qp.onclick = () => { openDoc('qp'); advanceStep(); };
  qpMsContainer.appendChild(qp);

  // Add MS and possibly ALT
  if (!altType) {
    const ms = document.createElement('button');
    ms.className = 'main'; ms.id = 'msBtn';
    ms.innerHTML = '<span class="hint">2</span>MS';
    ms.onclick = () => { openDoc('ms'); advanceStep(); };
    qpMsContainer.appendChild(ms);
  } else {
    const alt = document.createElement('button');
    alt.className = 'main'; alt.id = 'altBtn';
    alt.innerHTML = '<span class="hint">5</span>' + altLabel;
    alt.onclick = () => { openDoc(altType, altExt); advanceStep(); };

    const ms = document.createElement('button');
    ms.className = 'main'; ms.id = 'msBtn';
    ms.innerHTML = '<span class="hint">2</span>MS';
    ms.onclick = () => { openDoc('ms'); advanceStep(); };

    qpMsContainer.appendChild(alt);
    qpMsContainer.appendChild(ms);
  }
}

/* ========= UPDATE ER + GT BUTTONS ========= */
function updateOtherButtons() {
  document.getElementById('erBtn').onclick = () => { openDoc('er'); advanceStep(); };
  document.getElementById('gtBtn').onclick = () => { openDoc('gt'); advanceStep(); };
}

/* ========= EVENT LISTENERS ========= */
['year','paper'].forEach(id =>
  document.getElementById(id).addEventListener('input', () => {
    updateQPButtons(); updateOtherButtons();
  })
);
['subjectButtons','seasonButtons'].forEach(id =>
  document.getElementById(id).addEventListener('click', () => {
    updateQPButtons(); updateOtherButtons();
  })
);

/* ========= KEYBOARD HELPERS ========= */
function clearKbdGuides() { document.querySelectorAll('.kbd-step').forEach(el => el.classList.remove('kbd-step')); }
function markStep(step) {
  clearKbdGuides();
  const ids = ['subjectField','yearField','paperField','seasonField',null];
  if (ids[step]) document.getElementById(ids[step]).classList.add('kbd-step');
  else document.querySelector('.buttons').classList.add('kbd-step'); // last group
}
function clampStep() { if (kbdStep<0) kbdStep=0; if (kbdStep>4) kbdStep=4; markStep(kbdStep); }
function focusForStep() { 
  if (kbdStep === 1) document.getElementById('year').focus();
  else if (kbdStep === 2) document.getElementById('paper').focus();
  else document.activeElement.blur?.();
}
function selectByNumber(list, key) {
  const idx = parseInt(key, 10) - 1;
  if (idx >= 0 && list[idx]) list[idx].click();
}
function getSubjectButtons() { return Array.from(document.querySelectorAll('#subjectButtons button')); }
function getSeasonButtons() { return Array.from(document.querySelectorAll('#seasonButtons button')); }

/* ========= KEYBOARD HANDLING ========= */
document.addEventListener('keydown', (e) => {
  const inYear  = document.activeElement === document.getElementById('year');
  const inPaper = document.activeElement === document.getElementById('paper');
  const stepAtKeydown = kbdStep;

  // Tab/Enter move between steps
  if (e.key === 'Enter' || e.key === 'Tab') {
    e.preventDefault();
    if (e.shiftKey) retreatStep(); else advanceStep();
    return;
  }

  // Ignore number shortcuts while typing in inputs
  if (inYear || inPaper) return;
  if (!/^[0-9]$/.test(e.key)) return;

  // Step 0 = subject selection
  if (stepAtKeydown === 0) { e.preventDefault(); selectByNumber(getSubjectButtons(), e.key); }

  // Step 3 = season selection
  if (stepAtKeydown === 3) { e.preventDefault(); selectByNumber(getSeasonButtons(), e.key); }

  // Step 4 = document buttons → open directly (NO advanceStep to prevent wrapping)
  if (stepAtKeydown === 4) {
    e.preventDefault();
    const c = getCodes();
    if (!c) { showError("Fill all fields first."); return; }

    if (e.key === '1') {
      if (c.subject === 'French' && c.paper === '03') openDoc('tn');
      else openDoc('qp');
    } else if (e.key === '2') {
      openDoc('ms');
    } else if (e.key === '3') {
      openDoc('er');
    } else if (e.key === '4') {
      openDoc('gt');
    } else if (e.key === '5') {
      if (c.subject === 'English') {
        openDoc('in');
      } else if (c.subject === 'French' && c.paper && c.paper.startsWith('1')) {
        const y = parseInt(c.year, 10);
        openDoc(y >= 18 ? 'sf' : 'su', 'mp3');
      }
    }
  }
});

/* ========= INITIAL SETUP ========= */
updateQPButtons();
updateOtherButtons();
clampStep();
focusForStep();
</script>
</body>
</html>
